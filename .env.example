# ==============================================================================
# RecallBricks API v2.0 - Environment Configuration
# ==============================================================================

# ------------------------------------------------------------------------------
# Database Configuration (Required)
# ------------------------------------------------------------------------------
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# ------------------------------------------------------------------------------
# Service-to-Service Authentication (Required for RecallBricks Runtime)
# ------------------------------------------------------------------------------
# Secret token for internal service authentication
# Generate a secure random token: openssl rand -base64 32
RECALLBRICKS_SERVICE_TOKEN=your-secure-service-token-here

# ------------------------------------------------------------------------------
# AI Services (Required for specific features)
# ------------------------------------------------------------------------------

# OpenAI - Used for memory text extraction and embeddings
OPENAI_API_KEY=sk-...

# Anthropic - Used for relationship detection (optional, but recommended)
ANTHROPIC_API_KEY=sk-ant-...

# ------------------------------------------------------------------------------
# Server Configuration
# ------------------------------------------------------------------------------
PORT=8080
NODE_ENV=production

# CORS Origins (comma-separated, or * for all)
CORS_ORIGIN=https://app.recallbricks.com,https://recallbricks.com

# ------------------------------------------------------------------------------
# Logging
# ------------------------------------------------------------------------------
# Options: debug, info, warn, error
LOG_LEVEL=info

# ------------------------------------------------------------------------------
# Rate Limiting
# ------------------------------------------------------------------------------
# Global rate limit (requests per 15 minutes)
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=1000

# Per-API-key rate limit (requests per 15 minutes)
API_KEY_RATE_LIMIT_WINDOW_MS=900000
API_KEY_RATE_LIMIT_MAX_REQUESTS=500

# ------------------------------------------------------------------------------
# Circuit Breaker
# ------------------------------------------------------------------------------
# Number of failures before opening circuit
CIRCUIT_BREAKER_THRESHOLD=5

# Time to wait before attempting to close circuit (ms)
CIRCUIT_BREAKER_TIMEOUT=60000

# ==============================================================================
# RELATIONSHIP DETECTION CONFIGURATION
# ==============================================================================

# ------------------------------------------------------------------------------
# Claude API Configuration
# ------------------------------------------------------------------------------
# Claude model to use for relationship detection
# Options: claude-3-haiku-20240307 (recommended), claude-3-sonnet-20240229, claude-3-opus-20240229
CLAUDE_MODEL=claude-3-haiku-20240307

# Maximum tokens in Claude response
CLAUDE_MAX_TOKENS=2048

# Temperature for Claude API (0-1, lower = more focused)
CLAUDE_TEMPERATURE=0.3

# Request timeout for Claude API (ms)
CLAUDE_TIMEOUT=30000

# ------------------------------------------------------------------------------
# Detection Parameters
# ------------------------------------------------------------------------------
# Number of recent memories to analyze for relationships
# Higher = more accurate but slower and more expensive
# Range: 10-100, Recommended: 50
RELATIONSHIP_MEMORY_LIMIT=50

# Minimum confidence score for relationships (0-1)
# Higher = fewer but more accurate relationships
# Range: 0.5-0.9, Recommended: 0.6
RELATIONSHIP_MIN_STRENGTH=0.6

# Maximum number of relationships to detect per memory
# Range: 5-20, Recommended: 10
RELATIONSHIP_MAX_COUNT=10

# Maximum length of relationship explanation (characters)
RELATIONSHIP_EXPLANATION_MAX=200

# ------------------------------------------------------------------------------
# Retry Configuration
# ------------------------------------------------------------------------------
# Number of retry attempts on API failures
RELATIONSHIP_MAX_RETRIES=3

# Initial delay before first retry (ms)
RELATIONSHIP_RETRY_BASE_DELAY=1000

# Maximum delay between retries (ms)
RELATIONSHIP_RETRY_MAX_DELAY=10000

# Exponential backoff multiplier
RELATIONSHIP_RETRY_EXPONENT=2

# ------------------------------------------------------------------------------
# Circuit Breaker for Relationship Detection
# ------------------------------------------------------------------------------
# Number of consecutive failures before opening circuit
RELATIONSHIP_CB_THRESHOLD=5

# Time to keep circuit open before attempting recovery (ms)
RELATIONSHIP_CB_TIMEOUT=60000

# ------------------------------------------------------------------------------
# Feature Flags
# ------------------------------------------------------------------------------
# Enable/disable relationship detection entirely
RELATIONSHIP_DETECTION_ENABLED=true

# Execute relationship detection asynchronously (recommended)
# When true, memory creation returns immediately without waiting for detection
RELATIONSHIP_ASYNC=true

# Store detected relationships in database
# Set to false for testing without storing results
RELATIONSHIP_STORE_DB=true

# ==============================================================================
# PERFORMANCE TUNING PRESETS
# ==============================================================================

# PRESET: High Volume (1000+ memories/day, prioritize speed)
# RELATIONSHIP_MEMORY_LIMIT=20
# RELATIONSHIP_MAX_RETRIES=2
# RELATIONSHIP_CB_THRESHOLD=10

# PRESET: High Accuracy (prioritize relationship quality)
# RELATIONSHIP_MEMORY_LIMIT=100
# RELATIONSHIP_MIN_STRENGTH=0.8
# RELATIONSHIP_MAX_COUNT=15

# PRESET: Cost Optimized (minimize API costs)
# RELATIONSHIP_MEMORY_LIMIT=30
# RELATIONSHIP_MAX_COUNT=5
# CLAUDE_MODEL=claude-3-haiku-20240307

# ==============================================================================
# MONITORING & OBSERVABILITY
# ==============================================================================

# Prometheus metrics endpoint is available at /metrics
# Health check endpoint: /health
# Detailed health: /health/detailed
# Relationship health: /api/v1/relationships/health
